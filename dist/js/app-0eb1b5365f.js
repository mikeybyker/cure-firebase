!function(){"use strict";angular.module("cure",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngMessages","ngAria","ngResource","ngRoute","firebase","mm.foundation","toastr"])}(),function(){"use strict";angular.module("cure").factory("Utils",function(){var t={getRepeat:function(t){return new Array(t)},getAverage:function(t,e){return 0===t||0===e?0:Math.floor(t/e)||0}};return t})}(),function(){"use strict";angular.module("cure").factory("Vote",["$q","$log","Discog","Utils",function(t,e,r,n){function a(t,e,n){v=r.getTrack(t,e);var a=v.$loaded();return a.then(function(t){return o(n,e)}).then(function(t){return{track:v,ratings:g}})}function o(t,e){return g=r.getRatings(t,e),g.$loaded().then(function(t){return null===t.$value&&(t.$value=0),t})}function i(t,e){return e?t?(0===g.$value?(v.votes++,v.total+=e):v.total+=e-g.$value,g.$value=e,s(t)):c({status:400,statusText:"Missing trackId, can't vote..."}):c({status:400,statusText:"No value sent to vote!"})}function s(e){var n,a=g.$save(),o=v.$save();return n=r.setRank(e,l(v)),t.all([a,o,n])}function l(t){return{average:n.getAverage(t.total,t.votes),title:t.title,id:t.id,albumId:t.albumId}}function c(e){e=e||{status:404,statusText:"Not Found"};var r=t.defer();return r.reject(e),r.promise}function u(){return g.$destroy(),v.$destroy(),!0}var g,v;return{vote:function(t,e){return i(t,e)},initTrack:function(t,e,r){return a(t,e,r)},getUserRatings:function(){return g},destroy:function(){return u()}}}])}(),function(){"use strict";angular.module("cure").component("votingButtons",{bindings:{votes:"<",max:"<",onVote:"&"},controller:["Utils",function(t){this.getRepeat=t.getRepeat}],templateUrl:"app/components/vote/vote.html"})}(),function(){"use strict";angular.module("cure").component("ratingBar",{bindings:{total:"<",votes:"<",max:"<",showDetails:"<"},controller:["$log","Utils",function(t,e){this.getRepeat=e.getRepeat,this.getAverage=e.getAverage}],templateUrl:"app/components/rating/rating.html"})}(),function(){"use strict";angular.module("cure").component("navbar",{controller:["$location","$log","Auth",function(t,e,r){function n(){r.$signOut().then(function(){t.path("/")})}function a(e){return e===t.path()}var o=this;this.user=null,this.signout=n,this.active=a,r.$onAuthStateChanged(function(t){o.user=t})}],templateUrl:"app/components/navbar/navbar.html"})}(),function(){"use strict";function t(t,e,r,n,a,o,i,s,l,c){function u(t){o.vote(f,t.value).then(function(t){},function(t){r.info("Error : ",t),c.error(t.statusText,"Error")})}var g,v,d=this,m=t.id,f=t.track;return d.onVote=u,d.getAverage=s.getAverage,m&&f&&l.uid?(o.initTrack(m,f,l.uid).then(function(t){g=d.track=t.track,v=d.votes=t.ratings})["catch"](function(t){c.error(t.statusText,"Error",{onHidden:function(){a.path("/")}})}),i.getCover(t.id).then(function(t){d.cover=t}),void n.$on("$destroy",function(){o.destroy&&o.destroy()})):void a.path("/")}t.$inject=["$routeParams","$timeout","$log","$scope","$location","Vote","Discog","Utils","user","toastr"],angular.module("cure").controller("TrackController",t)}(),function(){"use strict";function t(t,e,r,n){var a=this;a.releaseId=t.id,r.getRelease(t.id).then(function(t){a.release=t[0],a.tracks=t[1]},function(t){n.error(t.statusText,"Error",{onHidden:function(){e.path("/")}})})}t.$inject=["$routeParams","$location","Discog","toastr"],angular.module("cure").controller("ReleaseController",t)}(),function(){"use strict";angular.module("cure").factory("FirebaseUtils",["$window",function(t){function e(t){var e=firebase.database().ref(),n=Array.prototype.slice.call(arguments);return n.length&&(e=e.child(r(n))),e}function r(t){for(var e=0;e<t.length;e++)if(angular.isArray(t[e]))t[e]=r(t[e]);else if(!angular.isString(t[e]))throw new Error("Argument "+e+" to firebaseRef is not a string: "+t[e]);return t.join("/")}return{firebase:function(){return firebase.database().ref()},timestamp:firebase.database.ServerValue.TIMESTAMP,ref:e}}])}(),function(){"use strict";angular.module("cure").factory("Discog",["$timeout","$q","$firebaseObject","$firebaseArray","FirebaseUtils",function(t,e,r,n,a){function o(e){var r=a.ref("releases/"+e);return r.once("value").then(function(e){return t(function(){return e.val()})})}function i(e){var r=a.ref("tracks/"+e);return r.once("value").then(function(e){return t(function(){return e.val()})})}var s={getDiscog:function(t){var e=a.ref("artist/"+t+"/discog").orderByChild("releaseYear");return n(e)},getCover:function(e){var r=a.ref("releases/"+e+"/coverFront");return r.once("value").then(function(e){return t(function(){return e.val()})})},getRanks:function(t){var e=a.ref("ranks").orderByChild("average").limitToLast(t);return n(e)},setRank:function(t,e){var r=a.ref("ranks/"+t).set(e);return r},getRatings:function(t,e){var n=a.ref("users/"+t+"/ratings/"+e);return r(n)},getTrack:function(t,e){var n=a.ref("tracks/"+t+"/"+e);return r(n)},getRelease:function(t){return e.all([o(t),i(t)])}};return s}])}(),function(){"use strict";function t(t,e){var r=this;r.discog=e.getDiscog("The Cure"),t.$on("$destroy",function(){r.discog.$destroy&&r.discog.$destroy()})}t.$inject=["$scope","Discog"],angular.module("cure").controller("DiscogController",t)}(),function(){"use strict";angular.module("cure").factory("Auth",["$firebaseAuth",function(t){return t()}])}(),function(){"use strict";angular.module("cure").controller("AuthController",["$location","$log","$scope","Discog","Auth","toastr",function(t,e,r,n,a,o){function i(r){r&&a.$signInWithPopup(r).then(function(e){t.path("/release")})["catch"](function(r){e.warn("error ::: ",r),o.error(r.statusText,"Error",{onHidden:function(){t.path("/")}})})}var s=this;s.oauthLogin=i,s.user=null,s.topTracks=n.getRanks(5),a.$onAuthStateChanged(function(t){s.user=t}),r.$on("$destroy",function(){s.topTracks.$destroy&&s.topTracks.$destroy()})}])}(),function(){"use strict";function t(t,e,r,n){r.$on("$routeChangeError",function(t,e,r,a){"AUTH_REQUIRED"===a&&n.path("/")})}t.$inject=["$log","$window","$rootScope","$location"],angular.module("cure").run(t)}(),function(){"use strict";function t(t){t.whenAuthenticated=function(e,r){return r.resolve=r.resolve||{},r.resolve.user=["Auth",function(t){return t.$requireSignIn()}],t.when(e,r),this},t.when("/",{templateUrl:"app/auth/login.html",controller:"AuthController",controllerAs:"vm",resolve:{requireNoAuth:["$location","Auth",function(t,e){return e.$requireSignIn().then(function(e){t.path("/discog")},function(t){})}]}}).when("/about",{templateUrl:"app/about/about.html"}).whenAuthenticated("/discog",{templateUrl:"app/discog/discog.html",controller:"DiscogController",controllerAs:"vm"}).whenAuthenticated("/discog/:id",{templateUrl:"app/release/release.html",controller:"ReleaseController",controllerAs:"vm"}).whenAuthenticated("/discog/:id/:track",{templateUrl:"app/track/track.html",controller:"TrackController",controllerAs:"vm"}).otherwise({redirectTo:"/"})}t.$inject=["$routeProvider"],angular.module("cure").config(t)}(),function(){"use strict";function t(t,e){t.debugEnabled(!0),e.allowHtml=!0,e.timeOut=2e3,e.positionClass="toast-top-right",e.preventDuplicates=!1,e.preventOpenDuplicates=!0,e.maxOpened=1,e.progressBar=!0}t.$inject=["$logProvider","toastrConfig"],angular.module("cure").config(t)}(),angular.module("cure").run(["$templateCache",function(t){t.put("app/about/about.html",'<div class=container><div class=row><div class="small-12 text-center columns"><h1>About</h1></div><div class="small-12 text-center columns"><div class="panel text-left"><p>An <a href=https://www.angularjs.org/ >Angular</a> 1.5 (@1.5.8) app with a <a href=https://firebase.google.com/ >Firebase</a> backend. View and rate albums/releases by The Cure. These are from my collection - CDs only.<br>I used <a href=http://www.collectorz.com/music/ >Music Collector</a> to scan my CDs and export the data, with a little massaging to get a Firebase friendly denormalized state.<br>One day I might get round to adding my vinyl etc. too - though that would take a long, long time. I have lots :-)</p><p>The CD cover images are as exported from Music Collector - far too many to rename to something nice, so they are what they are.</p></div></div></div></div>'),t.put("app/auth/login.html",'<div class=container><div class=row><div class="large-12 text-center columns"><div class="panel login-panel"><div class=login-buttons ng-if=!vm.user><button class="secondary button" ng-click="vm.oauthLogin(\'google\')">Google</button> <button class="secondary button" ng-click="vm.oauthLogin(\'facebook\')">Facebook</button></div></div></div></div><div class=row><div class="small-8 small-offset-2 text-center columns"><ul class="menu simple topthree"><li ng-repeat="track in vm.topTracks | orderBy:\'-average\'"><small>{{track.title}} ({{track.average}})</small></li></ul></div></div></div>'),t.put("app/discog/discog.html",'<div class=container><div class=row><div class="large-12 text-center columns"><img src=images/the-cure.png alt="The Cure"></div></div><div class="row small-up-2 medium-up-3 large-up-4"><div class="column release" ng-repeat="release in vm.discog"><a ng-href="#/discog/{{ release.$id}}">{{ release.title}}</a></div></div></div>'),t.put("app/release/release.html",'<div class=container><div class=row ng-hide=!vm.release.artist><div class="small-12 text-center columns"><a ng-href=#/discog><img src=images/the-cure.png alt="The Cure"></a><h1>{{vm.release.title}}</h1><small>{{vm.release.releaseDate}}</small></div><div class="small-12 medium-6 text-center columns"><div class=panel><img class=cover ng-src=images/covers/{{vm.release.coverFront}}><ul class="menu simple"><li><small>Label: {{vm.release.label}}</small></li><li><small>Tracks: {{vm.release.tracks}}</small></li></ul></div></div><div class="small-12 medium-6 panel-column columns"><div class="panel text-left"><ol><li class=tracks ng-repeat="track in vm.tracks"><a ng-href=#/discog/{{vm.releaseId}}/{{track.id}}>{{track.title}}</a></li></ol></div></div></div></div>'),t.put("app/track/track.html",'<div class=container><div class=row ng-hide=!vm.track.artist><div class="small-12 text-center columns"><a ng-href=#/discog><img src=images/the-cure.png alt="The Cure"></a><h1 class=release-title><a ng-href=#/discog/{{vm.track.albumId}}>{{vm.track.albumTitle}}</a></h1><small>{{vm.track.releaseDate}}</small></div><div class="small-12 medium-6 text-center columns"><div class=panel><img class=cover ng-src=images/covers/{{vm.cover}}></div></div><div class="small-12 medium-6 panel-column columns"><div class="panel panel-ratings"><h2>{{vm.track.title}}</h2><rating-bar total=vm.track.total votes=vm.track.votes max=5 show-details=true></rating-bar><ul class="menu simple"><li>Position: {{vm.track.position}}</li><li>Length: {{vm.track.length}}</li></ul><voting-buttons on-vote=vm.onVote($event) votes=vm.votes max=5></voting-buttons></div></div></div></div>'),t.put("app/components/navbar/navbar.html",'<div class=top-bar><div class=top-bar-left><ul class=menu><li ng-class="{ active: $ctrl.active(\'/\') || $ctrl.active(\'/discog\') }"><a ng-href=#/ >Home</a></li></ul></div><div class=top-bar-right ng-if=$ctrl.user><ul class="menu float-right"><li ng-class="{ active: $ctrl.active(\'/about\') }"><a ng-href=#/about>About</a></li><li><button class="hollow button success" ng-click=$ctrl.signout()>Sign Out</button></li></ul></div></div>'),t.put("app/components/rating/rating.html",'<div><div class=rating><span ng-class="{ \'selected\': ($ctrl.total/$ctrl.votes) >= ($index + 0.5)}" ng-repeat="i in $ctrl.getRepeat($ctrl.max) track by $index">☆</span></div><div ng-if=$ctrl.showDetails><small>Votes Cast: {{$ctrl.votes}}</small> | <small>Rating: {{$ctrl.getAverage($ctrl.total, $ctrl.votes)}}</small></div></div>'),t.put("app/components/vote/vote.html",'<div class=rate-buttons><h4>Rate</h4><div class=button-group><button class=button ng-class="{ \'alert\': $ctrl.votes.$value === ($index + 1)}" ng-click="$ctrl.onVote({$event: {value: ($index + 1)}});" ng-repeat="i in $ctrl.getRepeat($ctrl.max) track by $index">{{$index + 1}}</button></div><small>Your Rating: {{$ctrl.votes.$value || 0}}</small></div>')}]);
//# sourceMappingURL=../maps/js/app-0eb1b5365f.js.map
